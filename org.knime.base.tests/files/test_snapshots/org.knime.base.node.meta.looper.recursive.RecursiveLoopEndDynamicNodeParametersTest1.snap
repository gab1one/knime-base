{
  "data" : {
    "model" : {
      "recursionPortSettings" : [ {
        "minNrOfRows" : 1
      } ],
      "maxNrIterations" : 100,
      "flowVariableName" : null,
      "dataCollectionPortSettings" : [ {
        "collectDataFromLastIterationOnly" : false,
        "addIterationColumn" : false
      } ],
      "propagateFlowVariables" : false
    }
  },
  "schema" : {
    "type" : "object",
    "properties" : {
      "model" : {
        "type" : "object",
        "properties" : {
          "dataCollectionPortSettings" : {
            "type" : "array",
            "items" : {
              "type" : "object",
              "properties" : {
                "addIterationColumn" : {
                  "type" : "boolean",
                  "title" : "Add iteration column",
                  "description" : "Adds a column containing the iteration number to the corresponding collector output table.\nDisabled when only the last iteration is collected. Configurable per collector port.\n",
                  "default" : false
                },
                "collectDataFromLastIterationOnly" : {
                  "type" : "boolean",
                  "title" : "Collect data from last iteration only",
                  "description" : "If this option is checked, only the last input to the corresponding collecting data port is passed\nthrough to the outport. Hence, the data of earlier iterations is discarded. This option can be set for\neach collector port individually.\n",
                  "default" : false
                }
              }
            },
            "title" : "Data collection",
            "description" : "Configure how data from each collection port is collected across iterations.",
            "default" : [ ]
          },
          "flowVariableName" : {
            "type" : [ "string", "null" ],
            "title" : "End loop with variable",
            "description" : "Enables ending the loop based on a flow variable.\nWhen selected, choose the flow variable that terminates the loop when its value equals &#8220;true&#8221;.\n",
            "default" : null
          },
          "maxNrIterations" : {
            "type" : "integer",
            "format" : "int32",
            "title" : "Maximal number of iterations",
            "description" : "The maximum number of iterations the loop will run. Prevents endless loops.",
            "default" : 100
          },
          "propagateFlowVariables" : {
            "type" : "boolean",
            "title" : "Propagate modified loop variables",
            "description" : "If checked, variables whose values are modified within the loop are exported by this node. These variables\nmust be declared outside the loop, i.e. injected into the loop from a side-branch or be available upstream\nof the corresponding loop start node. For the latter, any modification of a variable is passed back to the\nstart node in subsequent iterations (e.g. moving sum calculation). Note that variables defined by the loop\nstart node itself are excluded as these usually represent loop controls (e.g. <i>\"currentIteration\"</i>).\n",
            "default" : false
          },
          "recursionPortSettings" : {
            "type" : "array",
            "items" : {
              "type" : "object",
              "properties" : {
                "minNrOfRows" : {
                  "type" : "integer",
                  "format" : "int64",
                  "title" : "Minimal number of rows for input port",
                  "description" : "Minimal number of rows for the recursion input table required to continue iterating.\nIf the number of rows falls below this threshold, the loop stops.\n",
                  "default" : 1
                }
              }
            },
            "title" : "Minimal number of rows",
            "description" : "The minimal number of rows for each recursion input table required to continue iterating.\nIf <b>one</b> of the tables falls below its configured minimum, the loop stops.\nThe minimum can be set per recursion input table individually.\n",
            "default" : [ ]
          }
        }
      }
    }
  },
  "ui_schema" : {
    "elements" : [ {
      "label" : "End Recursion Settings",
      "type" : "Section",
      "elements" : [ {
        "type" : "Control",
        "scope" : "#/properties/model/properties/recursionPortSettings",
        "options" : {
          "detail" : [ {
            "type" : "Control",
            "scope" : "#/properties/minNrOfRows",
            "options" : {
              "validation" : {
                "max" : {
                  "errorMessage" : "Value too large to process without risking precision loss (> 9007199254740991).",
                  "parameters" : {
                    "isExclusive" : false,
                    "max" : 9.007199254740991E15
                  }
                },
                "min" : {
                  "errorMessage" : "The value must be at least 0.",
                  "parameters" : {
                    "isExclusive" : false,
                    "min" : 0.0
                  }
                }
              }
            }
          } ],
          "arrayElementTitle" : "Recursion port",
          "hasFixedSize" : true
        }
      }, {
        "type" : "Control",
        "scope" : "#/properties/model/properties/maxNrIterations",
        "options" : {
          "validation" : {
            "max" : {
              "errorMessage" : "The value must not exceed 2147483647.",
              "parameters" : {
                "isExclusive" : false,
                "max" : 2.147483647E9
              }
            },
            "min" : {
              "errorMessage" : "The value must be greater than 0.",
              "parameters" : {
                "isExclusive" : true,
                "min" : 0.0
              }
            }
          }
        }
      }, {
        "type" : "Control",
        "scope" : "#/properties/model/properties/flowVariableName",
        "options" : {
          "format" : "dropDown",
          "hideOnNull" : true
        },
        "providedOptions" : [ "possibleValues", "default" ],
        "rule" : {
          "effect" : "DISABLE",
          "condition" : {
            "schema" : { }
          }
        }
      } ]
    }, {
      "label" : "Data Collection",
      "type" : "Section",
      "description" : "Configure how data from each collection port is collected across iterations.",
      "elements" : [ {
        "type" : "Control",
        "scope" : "#/properties/model/properties/dataCollectionPortSettings",
        "options" : {
          "detail" : [ {
            "type" : "Control",
            "scope" : "#/properties/collectDataFromLastIterationOnly",
            "options" : {
              "format" : "checkbox"
            }
          }, {
            "type" : "Control",
            "scope" : "#/properties/addIterationColumn",
            "options" : {
              "format" : "checkbox"
            },
            "rule" : {
              "effect" : "DISABLE",
              "condition" : {
                "scope" : "#/properties/collectDataFromLastIterationOnly",
                "schema" : {
                  "const" : true
                }
              }
            }
          } ],
          "arrayElementTitle" : "Collection port",
          "hasFixedSize" : true
        }
      } ]
    }, {
      "label" : "Flow Variables",
      "type" : "Section",
      "elements" : [ {
        "type" : "Control",
        "scope" : "#/properties/model/properties/propagateFlowVariables",
        "options" : {
          "format" : "checkbox"
        }
      } ]
    } ]
  },
  "persist" : {
    "type" : "object",
    "properties" : {
      "model" : {
        "type" : "object",
        "properties" : {
          "recursionPortSettings" : {
            "configPaths" : [ [ "minNumberOfRows" ] ]
          },
          "maxNrIterations" : {
            "configKey" : "maxNrIterations"
          },
          "flowVariableName" : {
            "configPaths" : [ [ "useFlowVariable" ], [ "flowVariableName" ] ]
          },
          "dataCollectionPortSettings" : {
            "configPaths" : [ [ "onlyLastData" ], [ "addIterationColumn" ] ]
          },
          "propagateFlowVariables" : {
            "configKey" : "propagateFlowVariables"
          }
        }
      }
    }
  },
  "initialUpdates" : [ {
    "scope" : "#/properties/model/properties/dataCollectionPortSettings",
    "values" : [ {
      "indices" : [ ],
      "value" : [ ]
    } ]
  }, {
    "scope" : "#/properties/model/properties/flowVariableName",
    "providedOptionName" : "default",
    "values" : [ {
      "indices" : [ ],
      "value" : ""
    } ]
  }, {
    "scope" : "#/properties/model/properties/flowVariableName",
    "providedOptionName" : "possibleValues",
    "values" : [ {
      "indices" : [ ],
      "value" : [ ]
    } ]
  }, {
    "scope" : "#/properties/model/properties/recursionPortSettings",
    "values" : [ {
      "indices" : [ ],
      "value" : [ ]
    } ]
  } ]
}